<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§è¡ä¹‹æ•° - è“è‰å åœ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SimSun', 'STSong', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #d4af37;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #d4af37;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            color: #d4af37;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            margin-bottom: 10px;
            letter-spacing: 8px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #c9a961;
            letter-spacing: 4px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            height: fit-content;
        }

        .divination-area {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            min-height: 500px;
        }

        .question-input {
            margin-bottom: 30px;
        }

        .question-input label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #d4af37;
        }

        .question-input textarea {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #d4af37;
            border-radius: 8px;
            color: #d4af37;
            font-size: 1em;
            font-family: 'SimSun', serif;
            resize: vertical;
            min-height: 100px;
        }

        .start-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #d4af37 0%, #c9a961 100%);
            border: none;
            border-radius: 10px;
            color: #1a1a2e;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 4px;
            font-family: 'SimSun', serif;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .start-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .hexagram-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .hexagram-lines {
            display: flex;
            flex-direction: column-reverse;
            gap: 15px;
        }

        .hexagram-line {
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            animation: fadeInLine 0.5s forwards;
        }

        @keyframes fadeInLine {
            to { opacity: 1; }
        }

        .line-number {
            color: #c9a961;
            font-size: 0.9em;
            width: 30px;
            text-align: right;
        }

        .line-visual {
            width: 300px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .line-segment {
            height: 6px;
            background: #d4af37;
            border-radius: 3px;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
            transition: all 0.3s;
        }

        .yang-line .line-segment {
            width: 100%;
        }

        .yin-line .line-segment {
            width: 45%;
        }

        .changing-mark {
            position: absolute;
            color: #ff6b6b;
            font-size: 1.5em;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .process-info {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .process-step {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }

        .process-step::before {
            content: "â–¸";
            position: absolute;
            left: 0;
            color: #d4af37;
        }

        .hexagram-name {
            font-size: 2em;
            color: #d4af37;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 6px;
        }

        .interpretation {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
            line-height: 2;
        }

        .interpretation h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.3em;
            letter-spacing: 3px;
        }

        .interpretation p {
            margin-bottom: 15px;
            text-indent: 2em;
        }

        .stalks-animation {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stalk {
            width: 3px;
            height: 40px;
            background: linear-gradient(to bottom, #8b7355, #654321);
            border-radius: 2px;
            animation: stalkFall 0.5s ease-out;
        }

        @keyframes stalkFall {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #c9a961);
            width: 0%;
            transition: width 0.5s;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .info-panel h2 {
            color: #d4af37;
            margin-bottom: 20px;
            letter-spacing: 4px;
        }

        .info-panel ol {
            padding-left: 25px;
            line-height: 2;
        }

        .info-panel li {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
                letter-spacing: 4px;
            }

            .line-visual {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¤§è¡ä¹‹æ•°</h1>
            <p class="subtitle">è“è‰å åœ Â· å¤æ³•å ç­®</p>
        </header>

        <div class="main-content">
            <div class="control-panel">
                <div class="question-input">
                    <label for="question">è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼š</label>
                    <textarea id="question" placeholder="é™å¿ƒè¯šæ„ï¼Œè¾“å…¥æ‚¨æ‰€æ±‚é—®ä¹‹äº‹..."></textarea>
                </div>
                <button class="start-button" id="startBtn">å¼€å§‹å åœ</button>
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="divination-area" id="divinationArea">
                <div style="text-align: center; color: #c9a961; padding: 50px 20px; line-height: 2;">
                    <p style="font-size: 1.2em; margin-bottom: 20px;">ğŸŒ¿ è“è‰å åœ ğŸŒ¿</p>
                    <p>å¤§è¡ä¹‹æ•°äº”åï¼Œå…¶ç”¨å››åæœ‰ä¹</p>
                    <p>åˆ†è€Œä¸ºäºŒä»¥è±¡ä¸¤ï¼ŒæŒ‚ä¸€ä»¥è±¡ä¸‰</p>
                    <p>æ²ä¹‹ä»¥å››ä»¥è±¡å››æ—¶ï¼Œå½’å¥‡äºæ‰ä»¥è±¡é—°</p>
                    <p style="margin-top: 30px; font-size: 0.9em;">é™å¿ƒå‡ç¥ï¼Œè¯šå¿ƒæ±‚é—®ï¼Œç‚¹å‡»"å¼€å§‹å åœ"</p>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h2>å åœè¯´æ˜</h2>
            <ol>
                <li><strong>å¤§è¡ä¹‹æ•°ï¼š</strong>å–è“è‰äº”åæ ¹ï¼Œå®ç”¨å››åä¹æ ¹ï¼Œè±¡å¾å¤©åœ°ä¹‹æ•°</li>
                <li><strong>ä¸‰å˜æˆçˆ»ï¼š</strong>æ¯ä¸€çˆ»éœ€ç»è¿‡ä¸‰æ¬¡æ¼”ç®—ï¼ˆåå…«å˜æˆå¦ï¼Œå…­çˆ»å…±éœ€åå…«å˜ï¼‰</li>
                <li><strong>å››è¥ä¹‹æ³•ï¼š</strong>åˆ†äºŒã€æŒ‚ä¸€ã€æ²å››ã€å½’å¥‡ï¼Œæ¨¡æ‹Ÿå¤©åœ°å››æ—¶ä¹‹è¿è¡Œ</li>
                <li><strong>è§£å¦ä¹‹æ³•ï¼š</strong>æ ¹æ®æœ±ç†¹ã€Šæ˜“å­¦å¯è’™ã€‹ï¼Œä¾åŠ¨çˆ»å¤šå°‘åˆ¤æ–­å‰å‡¶</li>
                <li><strong>è¯šå¿ƒæ±‚é—®ï¼š</strong>å åœè´µåœ¨è¯šå¿ƒï¼Œå¿ƒè¯šåˆ™çµï¼Œä¸è¯šåˆ™ä¸å </li>
            </ol>
        </div>
    </div>

    <script>
        // 64å¦æ•°æ®
        const hexagrams = {
            '111111': { name: 'ä¹¾ä¸ºå¤©', chinese: 'ä¹¾', description: 'å…ƒäº¨åˆ©è´ã€‚åˆšå¥ä¸­æ­£ï¼Œè‡ªå¼ºä¸æ¯ã€‚å¤§å‰å¤§åˆ©ä¹‹è±¡ã€‚' },
            '000000': { name: 'å¤ä¸ºåœ°', chinese: 'å¤', description: 'å…ƒäº¨ï¼Œåˆ©ç‰é©¬ä¹‹è´ã€‚æŸ”é¡ºæ‰¿è½½ï¼Œåšå¾·è½½ç‰©ã€‚é¡ºåˆ™å‰ã€‚' },
            '100010': { name: 'æ°´é›·å±¯', chinese: 'å±¯', description: 'å…ƒäº¨åˆ©è´ï¼Œå‹¿ç”¨æœ‰æ”¸å¾€ï¼Œåˆ©å»ºä¾¯ã€‚åˆå§‹è‰°éš¾ï¼Œå®ˆæ­£å¾…æ—¶ã€‚' },
            '010001': { name: 'å±±æ°´è’™', chinese: 'è’™', description: 'äº¨ã€‚åŒªæˆ‘æ±‚ç«¥è’™ï¼Œç«¥è’™æ±‚æˆ‘ã€‚å¯è’™æ•™åŒ–ï¼Œè¯šå¿ƒæ±‚é—®ã€‚' },
            '111010': { name: 'æ°´å¤©éœ€', chinese: 'éœ€', description: 'æœ‰å­šï¼Œå…‰äº¨ï¼Œè´å‰ï¼Œåˆ©æ¶‰å¤§å·ã€‚ç­‰å¾…æ—¶æœºï¼Œåšå®ˆæ­£é“ã€‚' },
            '010111': { name: 'å¤©æ°´è®¼', chinese: 'è®¼', description: 'æœ‰å­šï¼Œçª’æƒ•ï¼Œä¸­å‰ï¼Œç»ˆå‡¶ã€‚åˆ©è§å¤§äººï¼Œä¸åˆ©æ¶‰å¤§å·ã€‚è°¨æ…å¤„äº‹ã€‚' },
            '010000': { name: 'åœ°æ°´å¸ˆ', chinese: 'å¸ˆ', description: 'è´ï¼Œä¸ˆäººå‰ï¼Œæ— å’ã€‚ç»Ÿç‡ä¼—äººï¼Œæ­£é“è€Œè¡Œã€‚' },
            '000010': { name: 'æ°´åœ°æ¯”', chinese: 'æ¯”', description: 'å‰ã€‚åŸç­®ï¼Œå…ƒæ°¸è´ï¼Œæ— å’ã€‚äº²å¯†å’Œç¦ï¼Œå›¢ç»“äº’åŠ©ã€‚' },
            '111011': { name: 'é£å¤©å°ç•œ', chinese: 'å°ç•œ', description: 'äº¨ã€‚å¯†äº‘ä¸é›¨ï¼Œè‡ªæˆ‘è¥¿éƒŠã€‚ç§¯è“„åŠ›é‡ï¼Œå°æœ‰æ”¶è·ã€‚' },
            '110111': { name: 'å¤©æ³½å±¥', chinese: 'å±¥', description: 'å±¥è™å°¾ï¼Œä¸å’¥äººï¼Œäº¨ã€‚è°¨æ…è¡Œäº‹ï¼Œå¦‚å±¥è–„å†°ã€‚' },
            '111000': { name: 'åœ°å¤©æ³°', chinese: 'æ³°', description: 'å°å¾€å¤§æ¥ï¼Œå‰äº¨ã€‚å¤©åœ°äº¤æ³°ï¼Œé€šè¾¾é¡ºç•…ã€‚å¤§å‰ã€‚' },
            '000111': { name: 'å¤©åœ°å¦', chinese: 'å¦', description: 'å¦ä¹‹åŒªäººï¼Œä¸åˆ©å›å­è´ã€‚å¤©åœ°ä¸äº¤ï¼Œé—­å¡ä¸é€šã€‚' },
            '101111': { name: 'å¤©ç«åŒäºº', chinese: 'åŒäºº', description: 'åŒäººäºé‡ï¼Œäº¨ã€‚åˆ©æ¶‰å¤§å·ï¼Œåˆ©å›å­è´ã€‚å¿—åŒé“åˆã€‚' },
            '111101': { name: 'ç«å¤©å¤§æœ‰', chinese: 'å¤§æœ‰', description: 'å…ƒäº¨ã€‚å¤§æœ‰æ”¶è·ï¼Œä¸°ç››å¯Œè¶³ã€‚å¤§å‰ä¹‹è±¡ã€‚' },
            '001000': { name: 'åœ°å±±è°¦', chinese: 'è°¦', description: 'äº¨ï¼Œå›å­æœ‰ç»ˆã€‚è°¦è™šè°¨æ…ï¼Œå¿…å¾—å–„ç»ˆã€‚å‰ã€‚' },
            '000100': { name: 'é›·åœ°è±«', chinese: 'è±«', description: 'åˆ©å»ºä¾¯è¡Œå¸ˆã€‚å’Œæ‚¦å®‰ä¹ï¼Œé¡ºåŠ¿è€Œä¸ºã€‚' },
            '100110': { name: 'æ³½é›·éš', chinese: 'éš', description: 'å…ƒäº¨åˆ©è´ï¼Œæ— å’ã€‚é¡ºåº”æ—¶åŠ¿ï¼Œéšé‡è€Œå®‰ã€‚' },
            '011001': { name: 'å±±é£è›Š', chinese: 'è›Š', description: 'å…ƒäº¨ï¼Œåˆ©æ¶‰å¤§å·ã€‚é©é™¤ç§¯å¼Šï¼ŒæŒ¯ä½œå›¾å¼ºã€‚' },
            '110000': { name: 'åœ°æ³½ä¸´', chinese: 'ä¸´', description: 'å…ƒäº¨åˆ©è´ã€‚è‡³äºå…«æœˆæœ‰å‡¶ã€‚äº²ä¸´ç£å¯¼ï¼Œç››å¤§äº¨é€šã€‚' },
            '000011': { name: 'é£åœ°è§‚', chinese: 'è§‚', description: 'ç›¥è€Œä¸èï¼Œæœ‰å­šé¢™è‹¥ã€‚è§‚å¯Ÿçœè§†ï¼Œä»¥å¾·æœäººã€‚' },
            '100101': { name: 'ç«é›·å™¬å—‘', chinese: 'å™¬å—‘', description: 'äº¨ï¼Œåˆ©ç”¨ç‹±ã€‚åˆšæŸ”ç›¸æµï¼Œæ˜è¾¨æ˜¯éã€‚' },
            '101001': { name: 'å±±ç«è´²', chinese: 'è´²', description: 'äº¨ï¼Œå°åˆ©æœ‰æ”¸å¾€ã€‚æ–‡é¥°ç¾åŒ–ï¼Œå¤–è¡¨å…‰é²œã€‚' },
            '000001': { name: 'å±±åœ°å‰¥', chinese: 'å‰¥', description: 'ä¸åˆ©æœ‰æ”¸å¾€ã€‚å‰¥è½æ¶ˆå‡ï¼Œæ—¶è¿ä¸æµã€‚' },
            '100000': { name: 'åœ°é›·å¤', chinese: 'å¤', description: 'äº¨ã€‚å‡ºå…¥æ— ç–¾ï¼Œæœ‹æ¥æ— å’ã€‚åå¤å…¶é“ï¼Œä¸ƒæ—¥æ¥å¤ã€‚' },
            '100111': { name: 'å¤©é›·æ— å¦„', chinese: 'æ— å¦„', description: 'å…ƒäº¨åˆ©è´ã€‚å…¶åŒªæ­£æœ‰çœšï¼Œä¸åˆ©æœ‰æ”¸å¾€ã€‚è¯šå®å®ˆæ­£ã€‚' },
            '111001': { name: 'å±±å¤©å¤§ç•œ', chinese: 'å¤§ç•œ', description: 'åˆ©è´ï¼Œä¸å®¶é£Ÿå‰ï¼Œåˆ©æ¶‰å¤§å·ã€‚ç§¯è“„åŠ›é‡ï¼Œå¤§æœ‰æ‰€æˆã€‚' },
            '100001': { name: 'å±±é›·é¢', chinese: 'é¢', description: 'è´å‰ã€‚è§‚é¢ï¼Œè‡ªæ±‚å£å®ã€‚å…»ç”Ÿä¿®å¾·ï¼Œè‡ªé£Ÿå…¶åŠ›ã€‚' },
            '011110': { name: 'æ³½é£å¤§è¿‡', chinese: 'å¤§è¿‡', description: 'æ ‹æ¡¡ï¼Œåˆ©æœ‰æ”¸å¾€ï¼Œäº¨ã€‚éå¸¸æ—¶æœŸï¼Œéœ€æœ‰ä½œä¸ºã€‚' },
            '010010': { name: 'åä¸ºæ°´', chinese: 'å', description: 'ä¹ åï¼Œæœ‰å­šï¼Œç»´å¿ƒäº¨ï¼Œè¡Œæœ‰å°šã€‚é™©ä¸­æ±‚é€šï¼Œåšå®ˆä¿¡å¿µã€‚' },
            '101101': { name: 'ç¦»ä¸ºç«', chinese: 'ç¦»', description: 'åˆ©è´ï¼Œäº¨ã€‚ç•œç‰ç‰›ï¼Œå‰ã€‚å…‰æ˜é™„ä¸½ï¼ŒæŸ”é¡ºå‰ç¥¥ã€‚' },
            '001110': { name: 'æ³½å±±å’¸', chinese: 'å’¸', description: 'äº¨ï¼Œåˆ©è´ï¼Œå–å¥³å‰ã€‚æ„Ÿåº”äº¤æµï¼Œå¿ƒå¿ƒç›¸å°ã€‚' },
            '011100': { name: 'é›·é£æ’', chinese: 'æ’', description: 'äº¨ï¼Œæ— å’ï¼Œåˆ©è´ï¼Œåˆ©æœ‰æ”¸å¾€ã€‚æ’ä¹…ä¸å˜ï¼ŒæŒä¹‹ä»¥æ’ã€‚' },
            '001111': { name: 'å¤©å±±é', chinese: 'é', description: 'äº¨ï¼Œå°åˆ©è´ã€‚é€€é¿éšéï¼Œæ˜å“²ä¿èº«ã€‚' },
            '111100': { name: 'é›·å¤©å¤§å£®', chinese: 'å¤§å£®', description: 'åˆ©è´ã€‚åˆšå¼ºå£®å¤§ï¼Œæ­£å¤§å…‰æ˜ã€‚' },
            '000101': { name: 'ç«åœ°æ™‹', chinese: 'æ™‹', description: 'åº·ä¾¯ç”¨é”¡é©¬è•ƒåº¶ï¼Œæ˜¼æ—¥ä¸‰æ¥ã€‚æ™‹å‡è¿›æ­¥ï¼Œå‰é€”å…‰æ˜ã€‚' },
            '101000': { name: 'åœ°ç«æ˜å¤·', chinese: 'æ˜å¤·', description: 'åˆ©è‰°è´ã€‚å…‰æ˜å—æŸï¼Œè‰°éš¾å›°è‹¦ã€‚' },
            '101011': { name: 'é£ç«å®¶äºº', chinese: 'å®¶äºº', description: 'åˆ©å¥³è´ã€‚å®¶åº­å’Œç¦ï¼Œå„å®‰å…¶ä½ã€‚' },
            '110101': { name: 'ç«æ³½ç½', chinese: 'ç½', description: 'å°äº‹å‰ã€‚æ„è§ç›¸èƒŒï¼Œæ±‚åŒå­˜å¼‚ã€‚' },
            '001010': { name: 'æ°´å±±è¹‡', chinese: 'è¹‡', description: 'åˆ©è¥¿å—ï¼Œä¸åˆ©ä¸œåŒ—ï¼›åˆ©è§å¤§äººï¼Œè´å‰ã€‚è‰°éš¾å›°é¡¿ï¼Œå®ˆæ­£å¾…æ—¶ã€‚' },
            '010100': { name: 'é›·æ°´è§£', chinese: 'è§£', description: 'åˆ©è¥¿å—ï¼Œæ— æ‰€å¾€ï¼Œå…¶æ¥å¤å‰ã€‚æœ‰æ”¸å¾€ï¼Œå¤™å‰ã€‚è§£é™¤å›°å¢ƒï¼ŒåŒ–é™©ä¸ºå¤·ã€‚' },
            '110001': { name: 'å±±æ³½æŸ', chinese: 'æŸ', description: 'æœ‰å­šï¼Œå…ƒå‰ï¼Œæ— å’ï¼Œå¯è´ï¼Œåˆ©æœ‰æ”¸å¾€ã€‚å‡æŸæœ‰åº¦ï¼ŒæŸå·±ç›Šäººã€‚' },
            '100011': { name: 'é£é›·ç›Š', chinese: 'ç›Š', description: 'åˆ©æœ‰æ”¸å¾€ï¼Œåˆ©æ¶‰å¤§å·ã€‚å¢ç›Šè¿›å–ï¼Œåˆ©ç›Šä¼—äººã€‚' },
            '111110': { name: 'æ³½å¤©å¤¬', chinese: 'å¤¬', description: 'æ‰¬äºç‹åº­ï¼Œå­šå·æœ‰å‰ã€‚å‘Šè‡ªé‚‘ï¼Œä¸åˆ©å³æˆï¼Œåˆ©æœ‰æ”¸å¾€ã€‚æœæ–­å†³ç»ï¼Œåˆšå†³æŸ”ã€‚' },
            '011111': { name: 'å¤©é£å§¤', chinese: 'å§¤', description: 'å¥³å£®ï¼Œå‹¿ç”¨å–å¥³ã€‚ä¸æœŸè€Œé‡ï¼Œé˜´é•¿é˜³æ¶ˆã€‚' },
            '000110': { name: 'æ³½åœ°èƒ', chinese: 'èƒ', description: 'äº¨ï¼Œç‹å‡æœ‰åº™ï¼Œåˆ©è§å¤§äººï¼Œäº¨ï¼Œåˆ©è´ã€‚ç”¨å¤§ç‰²å‰ï¼Œåˆ©æœ‰æ”¸å¾€ã€‚èšé›†ä¼šåˆï¼Œå‰ç¥¥å¦‚æ„ã€‚' },
            '011000': { name: 'åœ°é£å‡', chinese: 'å‡', description: 'å…ƒäº¨ï¼Œç”¨è§å¤§äººï¼Œå‹¿æ¤ï¼Œå—å¾å‰ã€‚ä¸Šå‡å‘å±•ï¼Œæ¸è¿›å‘ä¸Šã€‚' },
            '010110': { name: 'æ³½æ°´å›°', chinese: 'å›°', description: 'äº¨ï¼Œè´ï¼Œå¤§äººå‰ï¼Œæ— å’ï¼Œæœ‰è¨€ä¸ä¿¡ã€‚å›°å¢ƒä¹‹ä¸­ï¼Œå®ˆæ­£å¾…æ—¶ã€‚' },
            '011010': { name: 'æ°´é£äº•', chinese: 'äº•', description: 'æ”¹é‚‘ä¸æ”¹äº•ï¼Œæ— ä¸§æ— å¾—ï¼Œå¾€æ¥äº•äº•ã€‚æ±”è‡³ï¼Œäº¦æœªç¹˜äº•ï¼Œç¾¸å…¶ç“¶ï¼Œå‡¶ã€‚å…»äººä¸ç©·ï¼Œæ’ä¹…ä¸å˜ã€‚' },
            '101110': { name: 'æ³½ç«é©', chinese: 'é©', description: 'å·±æ—¥ä¹ƒå­šï¼Œå…ƒäº¨åˆ©è´ï¼Œæ‚”äº¡ã€‚å˜é©æ›´æ–°ï¼Œé¡ºå¤©åº”äººã€‚' },
            '011101': { name: 'ç«é£é¼', chinese: 'é¼', description: 'å…ƒå‰ï¼Œäº¨ã€‚ç¨³å›ºé¼ç«‹ï¼Œå–æ–°å»æ•…ã€‚' },
            '100100': { name: 'éœ‡ä¸ºé›·', chinese: 'éœ‡', description: 'äº¨ã€‚éœ‡æ¥è™©è™©ï¼Œç¬‘è¨€å“‘å“‘ã€‚éœ‡æƒŠç™¾é‡Œï¼Œä¸ä¸§åŒ•é¬¯ã€‚éœ‡åŠ¨å¥‹èµ·ï¼Œåçœè­¦é†’ã€‚' },
            '001001': { name: 'è‰®ä¸ºå±±', chinese: 'è‰®', description: 'è‰®å…¶èƒŒï¼Œä¸è·å…¶èº«ï¼Œè¡Œå…¶åº­ï¼Œä¸è§å…¶äººï¼Œæ— å’ã€‚æ­¢äºæ‰€å½“æ­¢ï¼Œé™æ­¢å®‰å®šã€‚' },
            '001011': { name: 'é£å±±æ¸', chinese: 'æ¸', description: 'å¥³å½’å‰ï¼Œåˆ©è´ã€‚å¾ªåºæ¸è¿›ï¼Œç¨³æ­¥å‘å±•ã€‚' },
            '110100': { name: 'é›·æ³½å½’å¦¹', chinese: 'å½’å¦¹', description: 'å¾å‡¶ï¼Œæ— æ”¸åˆ©ã€‚å°‘å¥³å‡ºå«ï¼Œå¤„äº‹ä¸å½“ã€‚' },
            '101100': { name: 'é›·ç«ä¸°', chinese: 'ä¸°', description: 'äº¨ï¼Œç‹å‡ä¹‹ï¼Œå‹¿å¿§ï¼Œå®œæ—¥ä¸­ã€‚ç››å¤§ä¸°æ»¡ï¼ŒæŠŠæ¡æ—¶æœºã€‚' },
            '001101': { name: 'ç«å±±æ—…', chinese: 'æ—…', description: 'å°äº¨ï¼Œæ—…è´å‰ã€‚æ—…é€”å¥”æ³¢ï¼Œå°å¿ƒè°¨æ…ã€‚' },
            '011011': { name: 'å·½ä¸ºé£', chinese: 'å·½', description: 'å°äº¨ï¼Œåˆ©æœ‰æ”¸å¾€ï¼Œåˆ©è§å¤§äººã€‚è°¦é€ŠæŸ”é¡ºï¼Œæ¸è¿›è·ç›Šã€‚' },
            '110110': { name: 'å…‘ä¸ºæ³½', chinese: 'å…‘', description: 'äº¨ï¼Œåˆ©è´ã€‚å–œæ‚¦å’Œé¡ºï¼ŒçœŸè¯šäº¤å¾€ã€‚' },
            '010011': { name: 'é£æ°´æ¶£', chinese: 'æ¶£', description: 'äº¨ã€‚ç‹å‡æœ‰åº™ï¼Œåˆ©æ¶‰å¤§å·ï¼Œåˆ©è´ã€‚ç¦»æ•£æ¶£æ•£ï¼Œèšæ‹¢äººå¿ƒã€‚' },
            '110010': { name: 'æ°´æ³½èŠ‚', chinese: 'èŠ‚', description: 'äº¨ã€‚è‹¦èŠ‚ä¸å¯è´ã€‚èŠ‚åˆ¶æœ‰åº¦ï¼Œé€‚å¯è€Œæ­¢ã€‚' },
            '110011': { name: 'é£æ³½ä¸­å­š', chinese: 'ä¸­å­š', description: 'è±šé±¼å‰ï¼Œåˆ©æ¶‰å¤§å·ï¼Œåˆ©è´ã€‚è¯šä¿¡å®ˆä¿¡ï¼Œæ„ŸåŒ–ä¸‡ç‰©ã€‚' },
            '001100': { name: 'é›·å±±å°è¿‡', chinese: 'å°è¿‡', description: 'äº¨ï¼Œåˆ©è´ï¼Œå¯å°äº‹ï¼Œä¸å¯å¤§äº‹ã€‚å°æœ‰è¿‡å¤±ï¼Œè°¨å°æ…å¾®ã€‚' },
            '101010': { name: 'æ°´ç«æ—¢æµ', chinese: 'æ—¢æµ', description: 'äº¨å°ï¼Œåˆ©è´ï¼Œåˆå‰ç»ˆä¹±ã€‚åŠŸå¾·åœ†æ»¡ï¼Œç‰©æå¿…åã€‚' },
            '010101': { name: 'ç«æ°´æœªæµ', chinese: 'æœªæµ', description: 'äº¨ï¼Œå°ç‹æ±”æµï¼Œæ¿¡å…¶å°¾ï¼Œæ— æ”¸åˆ©ã€‚äº‹æœªå®Œæˆï¼Œè°¨æ…å‰è¡Œã€‚' }
        };

        class YarrowDivination {
            constructor() {
                this.lines = [];
                this.currentLine = 0;
                this.isRunning = false;
            }

            // ä¸€æ¬¡å˜åŒ–è¿‡ç¨‹ï¼ˆå››è¥ï¼‰
            singleChange(stalks) {
                // 1. åˆ†è€Œä¸ºäºŒ
                const rightGroup = Math.floor(Math.random() * (stalks - 1)) + 1;
                const leftGroup = stalks - rightGroup;

                // 2. æŒ‚ä¸€ï¼ˆä»å³ç»„å–ä¸€æ ¹ï¼‰
                let right = rightGroup - 1;
                let left = leftGroup;

                // 3. æ²ä¹‹ä»¥å››ï¼ˆå·¦ç»„ï¼‰
                const leftRemainder = left % 4 || 4;
                left -= leftRemainder;

                // 4. æ²ä¹‹ä»¥å››ï¼ˆå³ç»„ï¼‰
                const rightRemainder = right % 4 || 4;
                right -= rightRemainder;

                // å½’å¥‡äºæ‰ï¼ˆå·¦æ‰‹æŒ‡é—´çš„ç­¹ç­–æ•°ï¼‰
                const removed = 1 + leftRemainder + rightRemainder; // æŒ‚ä¸€ + å·¦ä½™ + å³ä½™

                return {
                    remaining: left + right,
                    removed: removed
                };
            }

            // ä¸‰å˜æˆä¸€çˆ»
            async getOneLine() {
                let stalks = 49;
                const changes = [];

                // ç¬¬ä¸€å˜
                let result = this.singleChange(stalks);
                changes.push(result);
                stalks = result.remaining;

                // ç¬¬äºŒå˜
                result = this.singleChange(stalks);
                changes.push(result);
                stalks = result.remaining;

                // ç¬¬ä¸‰å˜
                result = this.singleChange(stalks);
                changes.push(result);
                stalks = result.remaining;

                // æ ¹æ®æœ€ç»ˆä½™æ•°ç¡®å®šçˆ»çš„æ€§è´¨
                // å¯èƒ½çš„ä½™æ•°ï¼š24, 28, 32, 36
                let lineType;
                if (stalks === 24) {
                    lineType = { value: 1, type: 'old_yang', name: 'è€é˜³', changing: true }; // è€é˜³ï¼ˆä¹ï¼‰
                } else if (stalks === 28) {
                    lineType = { value: 0, type: 'old_yin', name: 'è€é˜´', changing: true }; // è€é˜´ï¼ˆå…­ï¼‰
                } else if (stalks === 32) {
                    lineType = { value: 1, type: 'young_yang', name: 'å°‘é˜³', changing: false }; // å°‘é˜³ï¼ˆä¸ƒï¼‰
                } else { // 36
                    lineType = { value: 0, type: 'young_yin', name: 'å°‘é˜´', changing: false }; // å°‘é˜´ï¼ˆå…«ï¼‰
                }

                return {
                    line: lineType,
                    stalks: stalks,
                    changes: changes
                };
            }

            // å®Œæ•´å åœï¼ˆå…­çˆ»ï¼‰
            async performDivination(callback) {
                this.lines = [];
                this.currentLine = 0;
                this.isRunning = true;

                for (let i = 0; i < 6; i++) {
                    if (!this.isRunning) break;

                    const result = await this.getOneLine();
                    this.lines.push(result);
                    this.currentLine = i + 1;

                    if (callback) {
                        await callback(i, result);
                    }

                    await this.sleep(800);
                }

                return this.lines;
            }

            getHexagram() {
                const binary = this.lines.map(l => l.line.value).join('');
                return hexagrams[binary] || { name: 'æœªçŸ¥å¦è±¡', chinese: '?', description: 'å¦è±¡æœªæ‰¾åˆ°' };
            }

            getChangedHexagram() {
                const changed = this.lines.map(l =>
                    l.line.changing ? (l.line.value === 1 ? 0 : 1) : l.line.value
                ).join('');
                return hexagrams[changed] || null;
            }

            getChangingLines() {
                return this.lines.map((l, i) => l.line.changing ? i : -1).filter(i => i >= 0);
            }

            getInterpretation() {
                const changingCount = this.getChangingLines().length;
                const originalHex = this.getHexagram();
                const changedHex = this.getChangedHexagram();

                let method = '';
                let interpretation = '';

                if (changingCount === 0) {
                    method = 'å…­çˆ»å®‰é™';
                    interpretation = `ä»¥æœ¬å¦${originalHex.chinese}å¦è¾åˆ¤æ–­ï¼š${originalHex.description}`;
                } else if (changingCount === 1) {
                    const lineNum = this.getChangingLines()[0] + 1;
                    method = 'ä¸€çˆ»åŠ¨';
                    interpretation = `ä»¥æœ¬å¦${originalHex.chinese}ç¬¬${lineNum}çˆ»çˆ»è¾åˆ¤æ–­ã€‚åŠ¨çˆ»ä¸ºå˜åŒ–ä¹‹æœºï¼Œéœ€ç‰¹åˆ«å…³æ³¨ã€‚`;
                } else if (changingCount === 2) {
                    const lines = this.getChangingLines().map(i => i + 1).join('ã€');
                    method = 'äºŒçˆ»åŠ¨';
                    interpretation = `ä»¥æœ¬å¦${originalHex.chinese}ç¬¬${lines}çˆ»çˆ»è¾åˆ¤æ–­ï¼Œä»¥ä¸Šçˆ»ä¸ºä¸»ã€‚`;
                } else if (changingCount === 3) {
                    method = 'ä¸‰çˆ»åŠ¨';
                    interpretation = `ä»¥æœ¬å¦${originalHex.chinese}ä¸å˜å¦${changedHex.chinese}çš„å¦è¾åˆ¤æ–­ï¼Œä»¥æœ¬å¦ä¸ºä¸»ã€‚`;
                } else if (changingCount === 4) {
                    method = 'å››çˆ»åŠ¨';
                    interpretation = `ä»¥å˜å¦${changedHex.chinese}äºŒé™çˆ»çˆ»è¾åˆ¤æ–­ï¼Œä»¥ä¸‹çˆ»ä¸ºä¸»ã€‚`;
                } else if (changingCount === 5) {
                    method = 'äº”çˆ»åŠ¨';
                    interpretation = `ä»¥å˜å¦${changedHex.chinese}é™çˆ»çˆ»è¾åˆ¤æ–­ã€‚`;
                } else {
                    method = 'å…­çˆ»å…¨åŠ¨';
                    const original = this.lines.map(l => l.line.value).join('');
                    if (original === '111111' || original === '000000') {
                        interpretation = `ä¹¾å¤ä¸¤å¦ç‰¹æ®Šï¼Œä»¥ç”¨çˆ»åˆ¤æ–­ã€‚`;
                    } else {
                        interpretation = `ä»¥å˜å¦${changedHex.chinese}å¦è¾åˆ¤æ–­ã€‚`;
                    }
                }

                return {
                    method: method,
                    interpretation: interpretation,
                    original: originalHex,
                    changed: changedHex,
                    changingCount: changingCount
                };
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            stop() {
                this.isRunning = false;
            }
        }

        // UIæ§åˆ¶
        const startBtn = document.getElementById('startBtn');
        const divinationArea = document.getElementById('divinationArea');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const questionInput = document.getElementById('question');

        const divination = new YarrowDivination();

        startBtn.addEventListener('click', async () => {
            const question = questionInput.value.trim();
            if (!question) {
                alert('è¯·å…ˆè¾“å…¥æ‚¨çš„é—®é¢˜');
                return;
            }

            startBtn.disabled = true;
            progressBar.style.display = 'block';
            divinationArea.innerHTML = '';

            // åˆ›å»ºæ˜¾ç¤ºåŒºåŸŸ
            const hexagramDisplay = document.createElement('div');
            hexagramDisplay.className = 'hexagram-display';
            hexagramDisplay.innerHTML = `
                <div class="process-info">
                    <div style="text-align: center; font-size: 1.2em; margin-bottom: 15px;">
                        é—®ï¼š${question}
                    </div>
                    <div id="processText">æ­£åœ¨èµ·å¦...</div>
                </div>
                <div class="hexagram-lines" id="hexagramLines"></div>
            `;
            divinationArea.appendChild(hexagramDisplay);

            const processText = document.getElementById('processText');
            const hexagramLines = document.getElementById('hexagramLines');

            await divination.performDivination(async (lineIndex, result) => {
                // æ›´æ–°è¿›åº¦
                const progress = ((lineIndex + 1) / 6) * 100;
                progressFill.style.width = progress + '%';

                // æ›´æ–°è¿‡ç¨‹ä¿¡æ¯
                processText.innerHTML = `
                    <div class="process-step">ç¬¬${lineIndex + 1}çˆ»ï¼šä¸‰å˜å®Œæˆ</div>
                    <div class="process-step">æœ€ç»ˆä½™ç­–ï¼š${result.stalks}æ ¹</div>
                    <div class="process-step">çˆ»è±¡ï¼š${result.line.name}${result.line.changing ? 'ï¼ˆåŠ¨çˆ»ï¼‰' : ''}</div>
                `;

                // æ·»åŠ çˆ»çº¿
                const lineDiv = document.createElement('div');
                lineDiv.className = 'hexagram-line';
                lineDiv.style.animationDelay = '0s';

                const isYang = result.line.value === 1;
                lineDiv.innerHTML = `
                    <span class="line-number">${lineIndex + 1}</span>
                    <div class="line-visual ${isYang ? 'yang-line' : 'yin-line'}">
                        ${isYang
                            ? '<div class="line-segment"></div>'
                            : '<div class="line-segment"></div><div class="line-segment"></div>'}
                        ${result.line.changing ? '<span class="changing-mark">â—‹</span>' : ''}
                    </div>
                    <span style="color: ${result.line.changing ? '#ff6b6b' : '#c9a961'};">
                        ${result.line.name}
                    </span>
                `;
                hexagramLines.appendChild(lineDiv);
            });

            // æ˜¾ç¤ºå¦è±¡å’Œè§£é‡Š
            await divination.sleep(500);

            const interpretation = divination.getInterpretation();
            const changedHex = divination.getChangedHexagram();

            const resultDiv = document.createElement('div');
            resultDiv.style.animationDelay = '0.3s';
            resultDiv.innerHTML = `
                <div class="hexagram-name">â˜° ${interpretation.original.name} â˜·</div>
                ${interpretation.changingCount > 0 ?
                    `<div style="text-align: center; color: #ff6b6b; margin: 10px 0;">
                        ${interpretation.changingCount}çˆ»å‘åŠ¨ â†’ ä¹‹å¦ï¼š${changedHex.name}
                    </div>` : ''}
                <div class="interpretation">
                    <h3>å¦è±¡è§£æ</h3>
                    <p><strong>æœ¬å¦ï¼š</strong>${interpretation.original.description}</p>
                    ${interpretation.changingCount > 0 ?
                        `<p><strong>ä¹‹å¦ï¼š</strong>${changedHex.description}</p>` : ''}
                    <h3>æ–­å¦æ–¹æ³•</h3>
                    <p><strong>${interpretation.method}ï¼š</strong>${interpretation.interpretation}</p>
                    <p style="text-indent: 0; margin-top: 20px; padding-top: 20px; border-top: 1px solid #d4af37; color: #c9a961; font-size: 0.9em;">
                        â€» å åœä¹‹é“ï¼Œè´µåœ¨è¯šå¿ƒã€‚å¦è±¡åªæ˜¯å‚è€ƒï¼Œæœ€ç»ˆè¿˜éœ€ç»“åˆå®é™…æƒ…å†µï¼Œä»¥æ™ºæ…§åˆ¤æ–­ï¼Œä»¥è¡ŒåŠ¨è·µè¡Œã€‚
                    </p>
                </div>
            `;
            divinationArea.appendChild(resultDiv);

            startBtn.disabled = false;
            progressBar.style.display = 'none';
            progressFill.style.width = '0%';
        });
    </script>
</body>
</html>
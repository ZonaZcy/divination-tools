<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大衍之数 - 蓍草占卜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SimSun', 'STSong', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #d4af37;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #d4af37;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            color: #d4af37;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            margin-bottom: 10px;
            letter-spacing: 8px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #c9a961;
            letter-spacing: 4px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            height: fit-content;
        }

        .divination-area {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            min-height: 500px;
        }

        .question-input {
            margin-bottom: 30px;
        }

        .question-input label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #d4af37;
        }

        .question-input textarea {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #d4af37;
            border-radius: 8px;
            color: #d4af37;
            font-size: 1em;
            font-family: 'SimSun', serif;
            resize: vertical;
            min-height: 100px;
        }

        .start-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #d4af37 0%, #c9a961 100%);
            border: none;
            border-radius: 10px;
            color: #1a1a2e;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 4px;
            font-family: 'SimSun', serif;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .start-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .hexagram-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .hexagram-lines {
            display: flex;
            flex-direction: column-reverse;
            gap: 15px;
        }

        .hexagram-line {
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            animation: fadeInLine 0.5s forwards;
        }

        @keyframes fadeInLine {
            to { opacity: 1; }
        }

        .line-number {
            color: #c9a961;
            font-size: 0.9em;
            width: 30px;
            text-align: right;
        }

        .line-visual {
            width: 300px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .line-segment {
            height: 6px;
            background: #d4af37;
            border-radius: 3px;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
            transition: all 0.3s;
        }

        .yang-line .line-segment {
            width: 100%;
        }

        .yin-line .line-segment {
            width: 45%;
        }

        .changing-mark {
            position: absolute;
            color: #ff6b6b;
            font-size: 1.5em;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .process-info {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .process-step {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }

        .process-step::before {
            content: "▸";
            position: absolute;
            left: 0;
            color: #d4af37;
        }

        .hexagram-name {
            font-size: 2em;
            color: #d4af37;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 6px;
        }

        .interpretation {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
            line-height: 2;
        }

        .interpretation h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.3em;
            letter-spacing: 3px;
        }

        .interpretation p {
            margin-bottom: 15px;
            text-indent: 2em;
        }

        .stalks-animation {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stalk {
            width: 3px;
            height: 40px;
            background: linear-gradient(to bottom, #8b7355, #654321);
            border-radius: 2px;
            animation: stalkFall 0.5s ease-out;
        }

        @keyframes stalkFall {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #c9a961);
            width: 0%;
            transition: width 0.5s;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .info-panel h2 {
            color: #d4af37;
            margin-bottom: 20px;
            letter-spacing: 4px;
        }

        .info-panel ol {
            padding-left: 25px;
            line-height: 2;
        }

        .info-panel li {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
                letter-spacing: 4px;
            }

            .line-visual {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>大衍之数</h1>
            <p class="subtitle">蓍草占卜 · 古法占筮</p>
        </header>

        <div class="main-content">
            <div class="control-panel">
                <div class="question-input">
                    <label for="question">请输入您的问题：</label>
                    <textarea id="question" placeholder="静心诚意，输入您所求问之事..."></textarea>
                </div>
                <button class="start-button" id="startBtn">开始占卜</button>
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="divination-area" id="divinationArea">
                <div style="text-align: center; color: #c9a961; padding: 50px 20px; line-height: 2;">
                    <p style="font-size: 1.2em; margin-bottom: 20px;">🌿 蓍草占卜 🌿</p>
                    <p>大衍之数五十，其用四十有九</p>
                    <p>分而为二以象两，挂一以象三</p>
                    <p>揲之以四以象四时，归奇于扐以象闰</p>
                    <p style="margin-top: 30px; font-size: 0.9em;">静心凝神，诚心求问，点击"开始占卜"</p>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h2>占卜说明</h2>
            <ol>
                <li><strong>大衍之数：</strong>取蓍草五十根，实用四十九根，象征天地之数</li>
                <li><strong>三变成爻：</strong>每一爻需经过三次演算（十八变成卦，六爻共需十八变）</li>
                <li><strong>四营之法：</strong>分二、挂一、揲四、归奇，模拟天地四时之运行</li>
                <li><strong>解卦之法：</strong>根据朱熹《易学启蒙》，依动爻多少判断吉凶</li>
                <li><strong>诚心求问：</strong>占卜贵在诚心，心诚则灵，不诚则不占</li>
            </ol>
        </div>
    </div>

    <script>
        // 64卦数据
        const hexagrams = {
            '111111': { name: '乾为天', chinese: '乾', description: '元亨利贞。刚健中正，自强不息。大吉大利之象。' },
            '000000': { name: '坤为地', chinese: '坤', description: '元亨，利牝马之贞。柔顺承载，厚德载物。顺则吉。' },
            '100010': { name: '水雷屯', chinese: '屯', description: '元亨利贞，勿用有攸往，利建侯。初始艰难，守正待时。' },
            '010001': { name: '山水蒙', chinese: '蒙', description: '亨。匪我求童蒙，童蒙求我。启蒙教化，诚心求问。' },
            '111010': { name: '水天需', chinese: '需', description: '有孚，光亨，贞吉，利涉大川。等待时机，坚守正道。' },
            '010111': { name: '天水讼', chinese: '讼', description: '有孚，窒惕，中吉，终凶。利见大人，不利涉大川。谨慎处事。' },
            '010000': { name: '地水师', chinese: '师', description: '贞，丈人吉，无咎。统率众人，正道而行。' },
            '000010': { name: '水地比', chinese: '比', description: '吉。原筮，元永贞，无咎。亲密和睦，团结互助。' },
            '111011': { name: '风天小畜', chinese: '小畜', description: '亨。密云不雨，自我西郊。积蓄力量，小有收获。' },
            '110111': { name: '天泽履', chinese: '履', description: '履虎尾，不咥人，亨。谨慎行事，如履薄冰。' },
            '111000': { name: '地天泰', chinese: '泰', description: '小往大来，吉亨。天地交泰，通达顺畅。大吉。' },
            '000111': { name: '天地否', chinese: '否', description: '否之匪人，不利君子贞。天地不交，闭塞不通。' },
            '101111': { name: '天火同人', chinese: '同人', description: '同人于野，亨。利涉大川，利君子贞。志同道合。' },
            '111101': { name: '火天大有', chinese: '大有', description: '元亨。大有收获，丰盛富足。大吉之象。' },
            '001000': { name: '地山谦', chinese: '谦', description: '亨，君子有终。谦虚谨慎，必得善终。吉。' },
            '000100': { name: '雷地豫', chinese: '豫', description: '利建侯行师。和悦安乐，顺势而为。' },
            '100110': { name: '泽雷随', chinese: '随', description: '元亨利贞，无咎。顺应时势，随遇而安。' },
            '011001': { name: '山风蛊', chinese: '蛊', description: '元亨，利涉大川。革除积弊，振作图强。' },
            '110000': { name: '地泽临', chinese: '临', description: '元亨利贞。至于八月有凶。亲临督导，盛大亨通。' },
            '000011': { name: '风地观', chinese: '观', description: '盥而不荐，有孚颙若。观察省视，以德服人。' },
            '100101': { name: '火雷噬嗑', chinese: '噬嗑', description: '亨，利用狱。刚柔相济，明辨是非。' },
            '101001': { name: '山火贲', chinese: '贲', description: '亨，小利有攸往。文饰美化，外表光鲜。' },
            '000001': { name: '山地剥', chinese: '剥', description: '不利有攸往。剥落消减，时运不济。' },
            '100000': { name: '地雷复', chinese: '复', description: '亨。出入无疾，朋来无咎。反复其道，七日来复。' },
            '100111': { name: '天雷无妄', chinese: '无妄', description: '元亨利贞。其匪正有眚，不利有攸往。诚实守正。' },
            '111001': { name: '山天大畜', chinese: '大畜', description: '利贞，不家食吉，利涉大川。积蓄力量，大有所成。' },
            '100001': { name: '山雷颐', chinese: '颐', description: '贞吉。观颐，自求口实。养生修德，自食其力。' },
            '011110': { name: '泽风大过', chinese: '大过', description: '栋桡，利有攸往，亨。非常时期，需有作为。' },
            '010010': { name: '坎为水', chinese: '坎', description: '习坎，有孚，维心亨，行有尚。险中求通，坚守信念。' },
            '101101': { name: '离为火', chinese: '离', description: '利贞，亨。畜牝牛，吉。光明附丽，柔顺吉祥。' },
            '001110': { name: '泽山咸', chinese: '咸', description: '亨，利贞，取女吉。感应交流，心心相印。' },
            '011100': { name: '雷风恒', chinese: '恒', description: '亨，无咎，利贞，利有攸往。恒久不变，持之以恒。' },
            '001111': { name: '天山遁', chinese: '遁', description: '亨，小利贞。退避隐遁，明哲保身。' },
            '111100': { name: '雷天大壮', chinese: '大壮', description: '利贞。刚强壮大，正大光明。' },
            '000101': { name: '火地晋', chinese: '晋', description: '康侯用锡马蕃庶，昼日三接。晋升进步，前途光明。' },
            '101000': { name: '地火明夷', chinese: '明夷', description: '利艰贞。光明受损，艰难困苦。' },
            '101011': { name: '风火家人', chinese: '家人', description: '利女贞。家庭和睦，各安其位。' },
            '110101': { name: '火泽睽', chinese: '睽', description: '小事吉。意见相背，求同存异。' },
            '001010': { name: '水山蹇', chinese: '蹇', description: '利西南，不利东北；利见大人，贞吉。艰难困顿，守正待时。' },
            '010100': { name: '雷水解', chinese: '解', description: '利西南，无所往，其来复吉。有攸往，夙吉。解除困境，化险为夷。' },
            '110001': { name: '山泽损', chinese: '损', description: '有孚，元吉，无咎，可贞，利有攸往。减损有度，损己益人。' },
            '100011': { name: '风雷益', chinese: '益', description: '利有攸往，利涉大川。增益进取，利益众人。' },
            '111110': { name: '泽天夬', chinese: '夬', description: '扬于王庭，孚号有厉。告自邑，不利即戎，利有攸往。果断决绝，刚决柔。' },
            '011111': { name: '天风姤', chinese: '姤', description: '女壮，勿用取女。不期而遇，阴长阳消。' },
            '000110': { name: '泽地萃', chinese: '萃', description: '亨，王假有庙，利见大人，亨，利贞。用大牲吉，利有攸往。聚集会合，吉祥如意。' },
            '011000': { name: '地风升', chinese: '升', description: '元亨，用见大人，勿恤，南征吉。上升发展，渐进向上。' },
            '010110': { name: '泽水困', chinese: '困', description: '亨，贞，大人吉，无咎，有言不信。困境之中，守正待时。' },
            '011010': { name: '水风井', chinese: '井', description: '改邑不改井，无丧无得，往来井井。汔至，亦未繘井，羸其瓶，凶。养人不穷，恒久不变。' },
            '101110': { name: '泽火革', chinese: '革', description: '己日乃孚，元亨利贞，悔亡。变革更新，顺天应人。' },
            '011101': { name: '火风鼎', chinese: '鼎', description: '元吉，亨。稳固鼎立，取新去故。' },
            '100100': { name: '震为雷', chinese: '震', description: '亨。震来虩虩，笑言哑哑。震惊百里，不丧匕鬯。震动奋起，反省警醒。' },
            '001001': { name: '艮为山', chinese: '艮', description: '艮其背，不获其身，行其庭，不见其人，无咎。止于所当止，静止安定。' },
            '001011': { name: '风山渐', chinese: '渐', description: '女归吉，利贞。循序渐进，稳步发展。' },
            '110100': { name: '雷泽归妹', chinese: '归妹', description: '征凶，无攸利。少女出嫁，处事不当。' },
            '101100': { name: '雷火丰', chinese: '丰', description: '亨，王假之，勿忧，宜日中。盛大丰满，把握时机。' },
            '001101': { name: '火山旅', chinese: '旅', description: '小亨，旅贞吉。旅途奔波，小心谨慎。' },
            '011011': { name: '巽为风', chinese: '巽', description: '小亨，利有攸往，利见大人。谦逊柔顺，渐进获益。' },
            '110110': { name: '兑为泽', chinese: '兑', description: '亨，利贞。喜悦和顺，真诚交往。' },
            '010011': { name: '风水涣', chinese: '涣', description: '亨。王假有庙，利涉大川，利贞。离散涣散，聚拢人心。' },
            '110010': { name: '水泽节', chinese: '节', description: '亨。苦节不可贞。节制有度，适可而止。' },
            '110011': { name: '风泽中孚', chinese: '中孚', description: '豚鱼吉，利涉大川，利贞。诚信守信，感化万物。' },
            '001100': { name: '雷山小过', chinese: '小过', description: '亨，利贞，可小事，不可大事。小有过失，谨小慎微。' },
            '101010': { name: '水火既济', chinese: '既济', description: '亨小，利贞，初吉终乱。功德圆满，物极必反。' },
            '010101': { name: '火水未济', chinese: '未济', description: '亨，小狐汔济，濡其尾，无攸利。事未完成，谨慎前行。' }
        };

        class YarrowDivination {
            constructor() {
                this.lines = [];
                this.currentLine = 0;
                this.isRunning = false;
            }

            // 一次变化过程（四营）
            singleChange(stalks) {
                // 1. 分而为二
                const rightGroup = Math.floor(Math.random() * (stalks - 1)) + 1;
                const leftGroup = stalks - rightGroup;

                // 2. 挂一（从右组取一根）
                let right = rightGroup - 1;
                let left = leftGroup;

                // 3. 揲之以四（左组）
                const leftRemainder = left % 4 || 4;
                left -= leftRemainder;

                // 4. 揲之以四（右组）
                const rightRemainder = right % 4 || 4;
                right -= rightRemainder;

                // 归奇于扐（左手指间的筹策数）
                const removed = 1 + leftRemainder + rightRemainder; // 挂一 + 左余 + 右余

                return {
                    remaining: left + right,
                    removed: removed
                };
            }

            // 三变成一爻
            async getOneLine() {
                let stalks = 49;
                const changes = [];

                // 第一变
                let result = this.singleChange(stalks);
                changes.push(result);
                stalks = result.remaining;

                // 第二变
                result = this.singleChange(stalks);
                changes.push(result);
                stalks = result.remaining;

                // 第三变
                result = this.singleChange(stalks);
                changes.push(result);
                stalks = result.remaining;

                // 根据最终余数确定爻的性质
                // 可能的余数：24, 28, 32, 36
                let lineType;
                if (stalks === 24) {
                    lineType = { value: 1, type: 'old_yang', name: '老阳', changing: true }; // 老阳（九）
                } else if (stalks === 28) {
                    lineType = { value: 0, type: 'old_yin', name: '老阴', changing: true }; // 老阴（六）
                } else if (stalks === 32) {
                    lineType = { value: 1, type: 'young_yang', name: '少阳', changing: false }; // 少阳（七）
                } else { // 36
                    lineType = { value: 0, type: 'young_yin', name: '少阴', changing: false }; // 少阴（八）
                }

                return {
                    line: lineType,
                    stalks: stalks,
                    changes: changes
                };
            }

            // 完整占卜（六爻）
            async performDivination(callback) {
                this.lines = [];
                this.currentLine = 0;
                this.isRunning = true;

                for (let i = 0; i < 6; i++) {
                    if (!this.isRunning) break;

                    const result = await this.getOneLine();
                    this.lines.push(result);
                    this.currentLine = i + 1;

                    if (callback) {
                        await callback(i, result);
                    }

                    await this.sleep(800);
                }

                return this.lines;
            }

            getHexagram() {
                const binary = this.lines.map(l => l.line.value).join('');
                return hexagrams[binary] || { name: '未知卦象', chinese: '?', description: '卦象未找到' };
            }

            getChangedHexagram() {
                const changed = this.lines.map(l =>
                    l.line.changing ? (l.line.value === 1 ? 0 : 1) : l.line.value
                ).join('');
                return hexagrams[changed] || null;
            }

            getChangingLines() {
                return this.lines.map((l, i) => l.line.changing ? i : -1).filter(i => i >= 0);
            }

            getInterpretation() {
                const changingCount = this.getChangingLines().length;
                const originalHex = this.getHexagram();
                const changedHex = this.getChangedHexagram();

                let method = '';
                let interpretation = '';

                if (changingCount === 0) {
                    method = '六爻安静';
                    interpretation = `以本卦${originalHex.chinese}卦辞判断：${originalHex.description}`;
                } else if (changingCount === 1) {
                    const lineNum = this.getChangingLines()[0] + 1;
                    method = '一爻动';
                    interpretation = `以本卦${originalHex.chinese}第${lineNum}爻爻辞判断。动爻为变化之机，需特别关注。`;
                } else if (changingCount === 2) {
                    const lines = this.getChangingLines().map(i => i + 1).join('、');
                    method = '二爻动';
                    interpretation = `以本卦${originalHex.chinese}第${lines}爻爻辞判断，以上爻为主。`;
                } else if (changingCount === 3) {
                    method = '三爻动';
                    interpretation = `以本卦${originalHex.chinese}与变卦${changedHex.chinese}的卦辞判断，以本卦为主。`;
                } else if (changingCount === 4) {
                    method = '四爻动';
                    interpretation = `以变卦${changedHex.chinese}二静爻爻辞判断，以下爻为主。`;
                } else if (changingCount === 5) {
                    method = '五爻动';
                    interpretation = `以变卦${changedHex.chinese}静爻爻辞判断。`;
                } else {
                    method = '六爻全动';
                    const original = this.lines.map(l => l.line.value).join('');
                    if (original === '111111' || original === '000000') {
                        interpretation = `乾坤两卦特殊，以用爻判断。`;
                    } else {
                        interpretation = `以变卦${changedHex.chinese}卦辞判断。`;
                    }
                }

                return {
                    method: method,
                    interpretation: interpretation,
                    original: originalHex,
                    changed: changedHex,
                    changingCount: changingCount
                };
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            stop() {
                this.isRunning = false;
            }
        }

        // UI控制
        const startBtn = document.getElementById('startBtn');
        const divinationArea = document.getElementById('divinationArea');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const questionInput = document.getElementById('question');

        const divination = new YarrowDivination();

        startBtn.addEventListener('click', async () => {
            const question = questionInput.value.trim();
            if (!question) {
                alert('请先输入您的问题');
                return;
            }

            startBtn.disabled = true;
            progressBar.style.display = 'block';
            divinationArea.innerHTML = '';

            // 创建显示区域
            const hexagramDisplay = document.createElement('div');
            hexagramDisplay.className = 'hexagram-display';
            hexagramDisplay.innerHTML = `
                <div class="process-info">
                    <div style="text-align: center; font-size: 1.2em; margin-bottom: 15px;">
                        问：${question}
                    </div>
                    <div id="processText">正在起卦...</div>
                </div>
                <div class="hexagram-lines" id="hexagramLines"></div>
            `;
            divinationArea.appendChild(hexagramDisplay);

            const processText = document.getElementById('processText');
            const hexagramLines = document.getElementById('hexagramLines');

            await divination.performDivination(async (lineIndex, result) => {
                // 更新进度
                const progress = ((lineIndex + 1) / 6) * 100;
                progressFill.style.width = progress + '%';

                // 更新过程信息
                processText.innerHTML = `
                    <div class="process-step">第${lineIndex + 1}爻：三变完成</div>
                    <div class="process-step">最终余策：${result.stalks}根</div>
                    <div class="process-step">爻象：${result.line.name}${result.line.changing ? '（动爻）' : ''}</div>
                `;

                // 添加爻线
                const lineDiv = document.createElement('div');
                lineDiv.className = 'hexagram-line';
                lineDiv.style.animationDelay = '0s';

                const isYang = result.line.value === 1;
                lineDiv.innerHTML = `
                    <span class="line-number">${lineIndex + 1}</span>
                    <div class="line-visual ${isYang ? 'yang-line' : 'yin-line'}">
                        ${isYang
                            ? '<div class="line-segment"></div>'
                            : '<div class="line-segment"></div><div class="line-segment"></div>'}
                        ${result.line.changing ? '<span class="changing-mark">○</span>' : ''}
                    </div>
                    <span style="color: ${result.line.changing ? '#ff6b6b' : '#c9a961'};">
                        ${result.line.name}
                    </span>
                `;
                hexagramLines.appendChild(lineDiv);
            });

            // 显示卦象和解释
            await divination.sleep(500);

            const interpretation = divination.getInterpretation();
            const changedHex = divination.getChangedHexagram();

            const resultDiv = document.createElement('div');
            resultDiv.style.animationDelay = '0.3s';
            resultDiv.innerHTML = `
                <div class="hexagram-name">☰ ${interpretation.original.name} ☷</div>
                ${interpretation.changingCount > 0 ?
                    `<div style="text-align: center; color: #ff6b6b; margin: 10px 0;">
                        ${interpretation.changingCount}爻发动 → 之卦：${changedHex.name}
                    </div>` : ''}
                <div class="interpretation">
                    <h3>卦象解析</h3>
                    <p><strong>本卦：</strong>${interpretation.original.description}</p>
                    ${interpretation.changingCount > 0 ?
                        `<p><strong>之卦：</strong>${changedHex.description}</p>` : ''}
                    <h3>断卦方法</h3>
                    <p><strong>${interpretation.method}：</strong>${interpretation.interpretation}</p>
                    <p style="text-indent: 0; margin-top: 20px; padding-top: 20px; border-top: 1px solid #d4af37; color: #c9a961; font-size: 0.9em;">
                        ※ 占卜之道，贵在诚心。卦象只是参考，最终还需结合实际情况，以智慧判断，以行动践行。
                    </p>
                </div>
            `;
            divinationArea.appendChild(resultDiv);

            startBtn.disabled = false;
            progressBar.style.display = 'none';
            progressFill.style.width = '0%';
        });
    </script>
</body>
</html>